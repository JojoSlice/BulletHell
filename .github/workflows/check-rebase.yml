name: Check Rebase

on:
  pull_request:
    branches:
      - main

jobs:
  check-rebase:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch main
        run: git fetch origin main

      - name: Kontrollera att PR är uppdaterad med main
        run: |
          BASE=$(git merge-base HEAD origin/main)
          if [ "$BASE" != "$(git rev-parse origin/main)" ]; then
            echo "❌ Din PR är inte uppdaterad med senaste main — rebase krävs."
            echo ""
            echo "Så här gör du:"
            echo "  git fetch origin main"
            echo "  git rebase origin/main"
            echo ""
            echo "Om rebase lyckas utan konflikter, kör sedan:"
            echo "  git push --force-with-lease"
            exit 1
          fi

      - name: ✔ Rebase OK
        if: success()
        run: echo "✨ Branchen är korrekt rebasad och uppdaterad med main!"